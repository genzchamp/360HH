<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Pro Fibonacci Calculator — 360 Halal Hustlers</title>
  <style>
    :root{--bg:#070708;--card:#0d0f10;--gold:#D4AF37;--muted:#9aa0a6;--glass:rgba(255,255,255,0.03);--radius:12px;font-family:Inter,system-ui;}
    html,body{height:100%;margin:0;background:transparent;color:#fff}
    .wrap{padding:18px}
    h2{color:var(--gold);margin:0 0 8px 0}
    .muted{color:var(--muted)}
    .panel{background:var(--card);padding:12px;border-radius:10px;border:1px solid var(--glass);max-width:920px}
    .grid{display:flex;gap:12px;flex-wrap:wrap}
    input{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(212,175,55,0.12);background:rgba(255,255,255,0.02);color:#fff}
    button{padding:10px;border-radius:8px;border:none;background:var(--gold);color:#071014;font-weight:700}
    .levels{margin-top:12px;background:rgba(255,255,255,0.02);padding:10px;border-radius:8px}
    .level{display:flex;justify-content:space-between;padding:8px 6px;border-bottom:1px solid rgba(255,255,255,0.03)}
    .level:last-child{border-bottom:none}
    a.closebtn{display:inline-block;margin-top:12px;padding:8px 10px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);text-decoration:none}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel">
      <h2>Pro Fibonacci Calculator</h2>
      <div class="muted">Enter swing high & swing low. Includes retracements and extension levels.</div>

      <div style="margin-top:12px" class="grid">
        <div style="flex:1;min-width:220px">
          <label class="muted">Swing High</label>
          <input id="high" type="number" placeholder="e.g. 1.20000"/>
        </div>
        <div style="flex:1;min-width:220px">
          <label class="muted">Swing Low</label>
          <input id="low" type="number" placeholder="e.g. 1.18000"/>
        </div>
        <div style="flex-basis:100px;align-self:flex-end">
          <button id="doCalc">Generate</button>
        </div>
      </div>

      <div id="out" class="levels">
        <div class="muted">Results appear here.</div>
      </div>

      <div>
        <a class="closebtn" href="#" onclick="parent.postMessage({type:'closeModal'}, '*'); return false;">Close (back)</a>
      </div>
    </div>
  </div>

<script>
  document.getElementById('doCalc').addEventListener('click', ()=>{
    const high = parseFloat(document.getElementById('high').value);
    const low = parseFloat(document.getElementById('low').value);
    const out = document.getElementById('out');
    if(isNaN(high) || isNaN(low) || high <= low){
      out.innerHTML = '<div style="color:#ff6666">Enter valid high & low (high must be greater than low).</div>';
      return;
    }
    const diff = high - low;
    const retr = {
      "0%": high,
      "23.6%": high - diff * 0.236,
      "38.2%": high - diff * 0.382,
      "50.0%": high - diff * 0.5,
      "61.8%": high - diff * 0.618,
      "78.6%": high - diff * 0.786,
      "100%": low
    };
    const ext = {
      "1.272": low - diff * 0.272,
      "1.618": low - diff * 0.618,
      "2.0": low - diff * 1.0,
      "2.618": low - diff * 1.618
    };
    let html = '<div><strong class="muted">Retracements</strong>';
    Object.keys(retr).forEach(k => {
      html += `<div class="level"><div>${k}</div><div>${retr[k].toFixed(5)}</div></div>`;
    });
    html += '</div><div style="margin-top:10px"><strong class="muted">Extensions</strong>';
    Object.keys(ext).forEach(k => {
      html += `<div class="level"><div>${k}</div><div>${ext[k].toFixed(5)}</div></div>`;
    });
    html += '</div>';
    out.innerHTML = html;
  });

  // allow parent to close
  window.addEventListener('message', (ev)=>{
    if(ev.data && ev.data.type === 'closeModal'){
      // parent asked to close — parent will handle
    }
  });
</script>
</body>
</html>