document.addEventListener('DOMContentLoaded', () => {
  const y = document.getElementById('year'); if (y) y.textContent = new Date().getFullYear();
  const modal = document.getElementById('modal'); const modalClose = document.getElementById('modalClose'); const toolFrame = document.getElementById('toolFrame');
  function openModal(url){ if(!modal) return; if(url && url.trim() !== ''){ toolFrame.src = url; } else { toolFrame.srcdoc = '<html><body style="background:#080808;color:#fff;padding:24px;font-family:Inter"><h3 style="color:#D4AF37">Coming soon</h3><p style="color:#cfcfcf">This tool will be available soon.</p><button onclick="parent.postMessage({type:\'closeModal\'}, \"*\")" style="background:#D4AF37;border:none;padding:10px;border-radius:8px;font-weight:700">Close</button></body></html>'; } modal.style.display = 'flex'; modal.setAttribute('aria-hidden','false'); document.body.style.overflow = 'hidden'; }
  function closeModal(){ if(!modal) return; modal.style.display = 'none'; modal.setAttribute('aria-hidden','true'); toolFrame.src = ''; document.body.style.overflow = ''; }
  modalClose && modalClose.addEventListener('click', closeModal); modal && modal.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); }); document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeModal(); });
  const openFibHero = document.getElementById('openFibHero'); openFibHero && openFibHero.addEventListener('click', ()=> openModal('pages/fx-tools/fib.html'));
  document.querySelectorAll('.card').forEach(card => { card.addEventListener('click', (e) => { if(card.classList.contains('disabled')) return; const href = card.getAttribute('data-href') || card.dataset.href; const target = href || card.getAttribute('data-href') || card.dataset.href; if(target && target.trim()){ openModal(target.trim()); } else { openModal(''); } }); });
  document.querySelectorAll('.carousel-nav').forEach(btn => { btn.addEventListener('click', () => { const target = btn.dataset.target; const carousel = document.getElementById(target + '-carousel'); if(!carousel) return; const cardWidth = carousel.querySelector('.card')?.offsetWidth || 260; if(btn.classList.contains('prev')){ carousel.scrollBy({left: -cardWidth - 16, behavior: 'smooth'}); } else { carousel.scrollBy({left: cardWidth + 16, behavior: 'smooth'}); } }); });
  const observer = new IntersectionObserver((entries) => { entries.forEach(en => { if(en.isIntersecting) en.target.classList.add('inview'); }); }, {threshold: 0.18}); document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
  document.querySelectorAll('.card').forEach(c => { c.addEventListener('touchstart', ()=> c.style.transform = 'translateY(-6px) scale(1.01)'); c.addEventListener('touchend', ()=> c.style.transform = ''); c.addEventListener('mousedown', ()=> c.style.transform = 'translateY(-6px) scale(1.01)'); c.addEventListener('mouseup', ()=> c.style.transform = ''; });
  window.addEventListener('message', (ev) => { if(ev.data && ev.data.type === 'closeModal') closeModal(); });
});
